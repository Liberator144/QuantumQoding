/**
 * GitHub Connection
 *
 * This module handles GitHub API connection for the QQ-Verse backend server.
 *
 * @version 1.0.0
 */
import { Octokit } from '@octokit/rest';
import { logger } from '../utils/logger';
import { config } from '../config';
/**
 * Octokit client instance
 */
let client = null;
/**
 * Connect to GitHub
 */
export const connectGitHub = async () => {
    try {
        if (client) {
            logger.info('Using existing GitHub connection');
            return client;
        }
        logger.info('Connecting to GitHub...');
        // Check if GitHub token is provided
        if (!config.database.github.token) {
            throw new Error('GitHub token not provided');
        }
        // Create Octokit client
        client = new Octokit({
            auth: config.database.github.token,
        });
        // Test connection
        const { data } = await client.users.getAuthenticated();
        logger.info(`GitHub connection established as ${data.login}`);
        return client;
    }
    catch (error) {
        // If GitHub is not configured, log a warning instead of an error
        if (!config.database.github.token ||
            error instanceof Error && error.message === 'GitHub token not provided') {
            logger.warn('GitHub not configured, skipping connection');
            return null;
        }
        logger.error('Failed to connect to GitHub:', error);
        throw error;
    }
};
/**
 * Get Octokit client
 */
export const getGitHubClient = () => {
    if (!client) {
        throw new Error('GitHub client not initialized');
    }
    return client;
};
export default {
    connectGitHub,
    getGitHubClient,
};
